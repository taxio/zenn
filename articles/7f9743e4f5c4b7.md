---
title: "Goã§æ—¥å ±ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ç¨¼åƒæ™‚é–“ã®é›†è¨ˆã‚’ã™ã‚‹"
emoji: "ğŸ“"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "tool"]
published: true
---

ã“ã‚Œã¯[Go Advent Calendar 2022](https://qiita.com/advent-calendar/2022/go)ã®9æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

å‰¯æ¥­ã‚„ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ãªã©ã§ã„ãã¤ã‚‚ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒæ™‚ä¸¦è¡Œã§ãŠæ‰‹ä¼ã„ã—ã¦ã„ã‚‹ã¨ã€ä»Šã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã©ã‚Œãã‚‰ã„ç¨¼åƒã‚’å‰²ã„ãŸã®ã‹æŠŠæ¡ã™ã‚‹ã®ãŒé›£ã—ããªã£ã¦ãã¾ã™ã€‚
ã“ã‚Œã«é–¢ã—ã¦ã€Google Calendar ãªã©ã«å‹¤æ€ æƒ…å ±ã‚’è¨˜éŒ²ã—ã¦å¾Œã‹ã‚‰ GAS ã§é›†è¨ˆã™ã‚‹ãªã©ã®ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚Šã¾ã™[^gcal]ã€‚

[^gcal]: https://qiita.com/umi_mori/items/4a9cc9e291d92101fe4a

è‡ªåˆ†ã¯æ™®æ®µ Private wiki (å€‹äºº [esa.io](https://esa.io/)) ã«è‰²ã€…ãªãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠã‚Šã€ç‰¹ã«[Template æ©Ÿèƒ½](https://docs.esa.io/posts/7)ã‚’ä½¿ã£ã¦ç¨¼åƒã®æ—¥å ±ã¿ãŸã„ãªãƒ¡ãƒ¢ã‚’ã‚ˆãæ›¸ã„ã¦ã„ã¾ã™ã€‚
Google Calendar ã§ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚‚è‰¯ã„ã®ã§ã™ãŒã€ãã®æ—¥ã«ä½•ã‚’ã—ãŸã®ã‹ã‚’è¨˜ã—ã¦ã„ã‚‹ãƒ¡ãƒ¢ãŒã‚ã‚‹ã®ã§ã€ãã£ã¡ã«ç¨¼åƒæ™‚é–“ã‚’è¨˜å…¥ã—é›†è¨ˆã§ããªã„ã‹ãªã¨æ€ã„ã¾ã—ãŸã€‚

### å®Ÿè£…

ä¸–ã®ä¸­ã«ã¯ Markdown ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä»˜ä¸ã§ãã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒã„ãã¤ã‹å­˜åœ¨ã—ã¾ã™ã€‚
ä»Šå›ã¯ zenn ã«ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã€Frontmatter ã‚’ä½¿ã£ã¦ Markdown å½¢å¼ã®æ—¥å ±ã«ç¨¼åƒæ™‚é–“ã‚’è¨˜éŒ²ã—ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜ã—ã€Go ã§ãã‚Œã‚’é›†è¨ˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã®ç´¹ä»‹ã‚’ã—ã¾ã™ã€‚

Frontmatter ã®ãƒ‘ãƒ¼ã‚¹ã«ã¯[adrg/frontmatter](https://github.com/adrg/frontmatter) ã‚’ä½¿ã„ã¾ã™ã€‚
```bash
go get github.com/adrg/frontmatter
```

ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒ¢ã« YAML å½¢å¼ã§ Frontmatter ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã¨ã—ã¦ã€ãã‚Œã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
(å¤§ä½“æ™®æ®µã“ã‚“ãªæ„Ÿã˜ã§æ›¸ã„ã¦ã¾ã™ã€‚)

```markdown
---
works:
  - start: 09:00
    end: 12:00
    memo: ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è€ƒãˆã‚‹
  - start: 13:00
    end: 15:00
    memo: æ¤œè¨¼ãƒ»å®Ÿè£…
---

## ã‚¿ã‚¹ã‚¯æ•´ç†
- [x] ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è€ƒãˆã‚‹
- [x] æ›¸ã
- [ ] å…¬é–‹ã™ã‚‹
- [ ] Next Action æ•´ç†

## ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è€ƒãˆã‚‹
æ™®æ®µãƒ¡ãƒ¢ã¨ä¸€ç·’ã«ç¨¼åƒæ™‚é–“ã‚’åŸ‹ã‚è¾¼ã‚“ã§é›†è¨ˆã—ã¦ã„ã‚‹ã€‚
ã“ã‚Œã‚’ç´¹ä»‹ã™ã‚‹ã®ã¯ã©ã†ã ã‚ã†ã‹ï¼Ÿ

## æ›¸ã
zenn ã«é ‘å¼µã£ã¦æ›¸ã„ãŸã€‚
PR: https://github.com/...

## Next Action
* Tweetã™ã‚‹
```

ãƒ‘ãƒ¼ã‚¹ã«ã¯ `frontmatter.Parse` ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
`io.Reader` ã¨å‰²ã‚Šå½“ã¦ãŸã„å¤‰æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¸¡ã›ã°è‰¯ã„ã§ã™ã€‚

```go
type Matter struct {
	Works []Work `yaml:"works"`
}

type Work struct {
	Start PeriodTime `yaml:"start"`
	End   PeriodTime `yaml:"end"`
	Memo  string     `yaml:"memo"`
}

type PeriodTime struct {
	Hour   int
	Minute int
}

func main() {
	var matter Matter
	frontmatter.Parse(strings.NewReader("<Markdownå½¢å¼ã®æœ¬æ–‡>", &matter))
}
```

æœ€çµ‚çš„ã« CSV ã¨ã‹ã«ã¾ã¨ã‚ãŸã„ã®ã§ã€æ™‚é–“ã®è¡¨è¨˜ã¯ `15:04` ã®ã‚ˆã†ã«ã—ãŸã„ã§ã™ã€‚
ãã®ãŸã‚ã«æ™‚é–“ã¨åˆ†ã‚’ä¿æŒã™ã‚‹ `PeriodTime` ã‚’å®šç¾©ã—ãŸã®ã§ã€ã“ã‚Œã‚’ Unmarshal ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã£ã¦ãŠãã¾ã—ã‚‡ã†ã€‚
ã¤ã„ã§ã«å‡ºåŠ›ç”¨ã® `String()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ç”¨æ„ã—ã¦ãŠãã¾ã™ã€‚

```go
func (t *PeriodTime) UnmarshalYAML(unmarshal func(interface{}) error) error {
	var buf string
	if err := unmarshal(&buf); err != nil {
		return err
	}
	tt, err := time.Parse("15:04", buf)
	if err != nil {
		return err
	}
	t.Hour = tt.Hour()
	t.Minute = tt.Minute()
	return nil
}

func (t *PeriodTime) String() string {
	return fmt.Sprintf("%02d:%02d", t.Hour, t.Minute)
}
```

ã‚ã¨ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦ CSV ã«å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚Œã°ã€ãã‚Œã£ã½ã„ã‚‚ã®ãŒå‡ºæ¥ä¸ŠãŒã‚Šã¾ã™ã€‚
è‡ªåˆ†ã¯ `{ProjectName}/{Year}/{Month}/{Day}` ã¿ãŸã„ãªãƒ‘ã‚¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ã„ã‚‹ã®ã§ã€ãã“ã‹ã‚‰ Project ã®åå‰ã‚„ãƒ¡ãƒ¢ã®æ—¥ä»˜ã‚’ç‰¹å®šã—ã¦ã„ã¾ã™ã€‚

```go
type Record struct {
	ProjectName string
	Date        time.Time
	Link        string
	Matter      Matter
}

func (r *Record) ToCSVLines() [][]string {
	var lines [][]string
	for _, work := range r.Matter.Works {
		lines = append(lines, []string{
			r.ProjectName,
			r.Date.Format("2006/01/02"),
			work.Start.String(),
			work.End.String(),
			work.Memo,
			r.Link,
		})
	}
	return lines
}

func main() {
	...
	record := Record{
		ProjectName: "Advent Calendar",
		Date:        time.Date(2022, 12, 9, 0, 0, 0, 0, time.FixedZone("Asia/Tokyo", 9*60*60)),
		Link:        "https://example.com/notes/AdventCalendar/2022/12/09",
		Matter:      matter,
	}
	csvLines := record.ToCSVLines()

	w := csv.NewWriter(os.Stdout)
	header := []string{"ProjectName", "Date", "Start", "End", "Memo", "Link"}
	w.WriteAll(append([][]string{header}, csvLines...))
}
```

å‡ºåŠ›çµæœä¾‹:

| ProjectName | Date | Start | End | Memo | Link |
| --- | --- | --- | --- | --- | --- |
| Advent Calendar | 2022/12/09 | 09:00 | 12:00 | ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è€ƒãˆã‚‹ | https://example.com/notes/AdventCalendar/2022/12/09 |
| Advent Calendar | 2022/12/09 | 13:00 | 15:00 | æ¤œè¨¼ãƒ»å®Ÿè£… | https://example.com/notes/AdventCalendar/2022/12/09 |

å‰²ã¨å˜ç´”ãªã‚¢ã‚¤ãƒ‡ã‚¢ã§ã™ãŒã€ãƒ¡ãƒ¢é­”ã®è‡ªåˆ†çš„ã«ã¯æ™®æ®µã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‹ã‚‰ãã®ã¾ã¾ç¨¼åƒã®ã‚µãƒãƒªãªã‚“ã‹ã‚’ä½œã‚Œã¦ã—ã¾ã†ã®ã§çµæ§‹é‡å®ã—ã¦ã„ã¾ã™ã€‚
ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›ã—ã¦ã‚‚ã†å°‘ã—ãƒªãƒƒãƒã«ã™ã‚Œã°ç¨¼åƒã®æ®‹ã‚Šæ™‚é–“ã®ç¢ºèªã‚„ã€ãã“ã‹ã‚‰ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¦‹ç›´ã—ãªã‚“ã‹ã‚‚ã§ãã¾ã™ã—ã­ã€‚

ã‚ã¨ã¯ã“ã‚Œã‚’ GitHub Actions ã§å®šæœŸå®Ÿè¡Œã—ãŸã‚Šã€é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯ã‚’å‡ã£ãŸã‚Šã—ã¦ã©ã‚“ã©ã‚“ç›†æ ½åŒ–ã—ã¾ã™ã€‚

ä»Šå›ä½¿ã£ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒã¯ã“ã¡ã‚‰ã‹ã‚‰: https://gist.github.com/taxio/3ab5d9b1fb01b2c5503d7afb6d21caea
