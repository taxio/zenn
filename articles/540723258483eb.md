---
title: "RIP-7560: Native Account Abstraction"
emoji: "ğŸ‘›"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AccountAbstraction", "Ethereum"]
published: false
---

å…ˆæ—¥ ERC-4337 ã® Author ãŸã¡ã‹ã‚‰ "RIP-7650 Native Account Abstraction" ã¨ã„ã† Proposal ãŒæå‡ºã•ã‚Œã¾ã—ãŸã€‚

https://github.com/ethereum/RIPs/pull/3

description ã‚’è¦‹æ¯”ã¹ã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ãŒã€ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ãƒ¬ã‚¤ãƒ¤ã«æ‰‹ã‚’å…¥ã‚Œã¦æœ¬æ ¼çš„ã« Native Account Abstraction ã‚’é”æˆã™ã‚‹ãŸã‚ã® Proposal ã«ãªã£ã¦ã„ã¾ã™ã€‚

> An account abstraction proposal which completely avoids consensus-layer protocol changes, instead relying on higher-layer infrastructure.
> -- [ERC-4337](https://eips.ethereum.org/EIPS/eip-4337)

> An account abstraction proposal that introduces consensus-layer protocol changes, instead of relying on higher-layer infrastructure.
> -- [RIP-7560](https://github.com/eth-infinitism/RIPs/blob/e8af8009251f24e67311e0d955e7a951284717fc/RIPS/rip-7560.md)

RIP ã¨ã„ã†èãæ…£ã‚Œãªã„ prefix ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ Rollup Improvement Proposals ã®ç•¥ã§ã€Ethereum ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ãƒ­ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã®æ¨™æº–åŒ–ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

ãŸã ã—æ¨™æº–ã¨ã¯ã„ã£ã¦ã‚‚å¸¸ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€Ethereum ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ã“ã‚Œã‚’å¼·åˆ¶ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

https://github.com/ethereum/RIPs

## Account Abstraction ãŠã•ã‚‰ã„
> In short, account abstraction means that not only the execution of a transaction can be arbitrarily complex computation logic as specified by the EVM, but also the authorization logic of a transaction would be opened up so that users could create accounts with whatever authorization logic they want.
> -- https://ethereum-magicians.org/t/implementing-account-abstraction-as-part-of-eth1-x/4020

è©³ã—ãã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

https://zenn.dev/sivira_inc/articles/d041f1ac44ca1e

https://zenn.dev/sivira_inc/articles/34e8147f206ff5

### EIP-2938
https://eips.ethereum.org/EIPS/eip-2938

### ERC-4337
https://eips.ethereum.org/EIPS/eip-4337

## RIP-7560 ã®ä»•æ§˜ã¨ ERC-4337 ã¨ã®å·®åˆ†
ã–ã£ãã‚Šä¸€è¨€ã§ã„ã†ã¨ã€Bundler ã¨ EntryPoint ãŒã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ãƒ¬ã‚¤ãƒ¤ã«ãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè£…ã•ã‚Œã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ã¯ã„ã¤ã‚‚é€šã‚Š RPC ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦é€šå¸¸ã® EOA èµ·ç‚¹ã® Tx ã‚’æŠ•ã’ã‚‹ã‚ˆã†ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Œã°ãã® Tx ãŒ Block ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚

### AA Transactions
ä»¥ä¸‹ãŒ Account Absraction ç”¨ã®æ–°ã—ã„ Transaction Type ã§ã™ã€‚
```solidity
struct TransactionType4 {
    address sender;
    uint256 nonce;
    uint256 validationGasLimit;
    uint256 paymasterGasLimit;
    uint256 callGasLimit;
    uint256 maxFeePerGas;
    uint256 maxPriorityFeePerGas;
    uint256 builderFee;
    bytes paymasterData;
    bytes deployerData;
    bytes callData;
    bytes signature;
}
```

UserOpration ã¨ã®å·®åˆ†ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

* `validationGasLimit`, `paymasterGasLimit`, `callGasLimit`
  * å„ã‚¹ãƒ†ãƒƒãƒ—ã§åˆ©ç”¨ã§ãã‚‹ Gas unit ã®æœ€å¤§å€¤
* `maxFeePerGas`, `maxPriorityFeePerGas`
  * EIP-1559 ã§å®šç¾©ã•ã‚Œã‚‹ Gas ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
* `builderFee`
  * UserOperation ã§ã¯ `maxFeePerGas`, `maxPriorityFeePerGas` ã ã£ãŸã‚‚ã®
  * ã“ã“ã«æŒ‡å®šã—ãŸé‡‘é¡ã¯ Block header ã® coinbase ã«æ¸¡ã•ã‚Œã‚‹
  * L2 Rollup ãªã©ã€offchain ã§ç™ºç”Ÿã™ã‚‹ã‚³ã‚¹ãƒˆã«å¯¾ã™ã‚‹ãƒãƒƒãƒ—
* `paymasterData`
  * `paymasterAndData` ã¨åŒã˜
* `deployerData`
  * `initCode` ã¨åŒã˜

### å®Ÿè¡Œã®æµã‚Œ
> ![Flow diagram](/images/540723258483eb/flow_diagram.png)
> -- https://github.com/eth-infinitism/RIPs/blob/e8af8009251f24e67311e0d955e7a951284717fc/RIPS/rip-7560.md#execution-flow-diagram

#### Validation Phase
* Nonce validation frame
  * EntryPoint ã¨åŒã˜ Two-dimensional nonce [^two-dimensional-nonce]
  * ã©ã†ã‚„ã£ã¦é‹ç”¨ã•ã‚Œã‚‹ã‹ã¯è­°è«–ä¸­
* Sender deployment frame
  * `validationGasLimit` ã‚’æ¶ˆè²»
  * `AA_SENDER_CREATOR` ãŒ `deployerData` ã«å¾“ã£ã¦ Account Contract ã‚’ deploy ã™ã‚‹
* Sender validation frame
  * `validationGasLimit` ã‚’æ¶ˆè²»
  * `function validateTransaction(uint256 version, bytes32 txHash, bytes transaction) external returns (uint256 validationData);`
* Paymaster validation frame
  * `paymasterGasLimit` ã‚’æ¶ˆè²»
  * `function validatePaymasterTransaction(uint256 version, bytes32 txHash, bytes transaction) external returns (bytes context, uint256 validationData);`

[^two-dimensional-nonce]: https://docs.google.com/document/d/1MywdH_TCkyEjD3QusLZ_kUZg4ZEI00qp97mBze9JI4k/edit

#### Execution Phase
* Sender execution frame
  * `callGasLimit` ã‚’æ¶ˆè²»
  * `sender` ã«å¯¾ã—ã¦ `callData` ãŒ invoke ã•ã‚Œã‚‹
  * ã“ã® execution frame ãŒ revert ã•ã‚Œã¦ã‚‚ã€validation frame ã¯ revert ã•ã‚Œãªã„
* Paymaster post-transaction frame
  * `paymasterGasLimit` ã‚’æ¶ˆè²»
  * `function postPaymasterTransaction(bool success, uint256 actualGasCost, bytes context) external;`
    * `success` ã¯ç›´å‰ã® execution frame ãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹

### Validation, Execution Tx ã®åˆ†é›¢
* Builder ã¯ AA Tx ã‚’ Validation, Execution ã®2ã¤ã® Tx ã«åˆ†é›¢ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
* Validation Tx ãŒå¤±æ•—ã—ãŸå ´åˆã€Execution Tx ã¯å®Ÿè¡Œã—ãªãã¦ã„ã„ã‹ã‚‰

### RPC ã¸ã®å®Ÿè£…è¿½åŠ 
* `eth_sendTransaction`, `eth_sendRawTransaction`
* `eth_signTransaction`
* `eth_getTransactionReceipt`
* `eth_call`
* `eth_estimateGasAccountAbstraction` (New)

## Native AA ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ L2 ã¨ã®æ¯”è¼ƒ
### zkSync

### StarkNet

### ä»Šå¾Œã® L2 å¯¾å¿œã«ã¤ã„ã¦ã®è€ƒå¯Ÿ

## é–¢é€£ Proposal
### ERC-7562

### ERC-5003

### ERC-6913

### ERC-7377
